<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19 Global Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Your existing CSS styles remain exactly the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .confirmed {
            color: #ff6b6b;
        }

        .recovered {
            color: #51cf66;
        }

        .deaths {
            color: #868e96;
        }

        .active {
            color: #339af0;
        }

        .search-container {
            margin-bottom: 20px;
            position: relative;
        }

        #countrySearch {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1rem;
            outline: none;
        }

        #countrySearch::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dropdown-item {
            padding: 10px 15px;
            color: #333;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            min-height: 40px;
            align-items: center;
        }

        .dropdown-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .country-cases {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .country-details {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .country-details.active {
            display: block;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .detail-title {
            font-size: 1.8rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .detail-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .detail-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .detail-stat {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.15);
        }

        .detail-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .global-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        @media (max-width: 1024px) {
            .global-charts {
                grid-template-columns: 1fr;
            }
        }

        .global-chart-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
        }

        .global-chart-title {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .global-chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }

        .loading {
            text-align: center;
            padding: 15px;
            font-size: 1rem;
        }

        .error {
            text-align: center;
            padding: 15px;
            color: #ff6b6b;
            font-size: 1rem;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .no-countries-message {
            text-align: center;
            padding: 20px;
            font-style: italic;
            opacity: 0.7;
            margin-top: 10px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom: 3px solid #ff6b6b;
            color: #ff6b6b;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .country-placeholder {
            text-align: center;
            padding: 60px 20px;
            font-style: italic;
            opacity: 0.7;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-top: 40px; /* Increased margin to move it down */
        }

        .country-placeholder h3 {
            margin-bottom: 15px;
            font-size: 1.3rem; /* Reduced from 1.5rem */
        }

        .country-placeholder p {
            font-size: 1rem; /* Reduced from 1.1rem */
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .search-card {
            max-width: 600px;
            margin: 0 auto;
        }

        .countries-content {
            position: relative;
            min-height: 400px;
        }

        .country-details-container {
            display: none;
        }

        .country-details-container.active {
            display: block;
        }

        .country-placeholder-container {
            display: block;
        }

        .country-placeholder-container.hidden {
            display: none;
        }

        .dropdown::-webkit-scrollbar {
            width: 6px;
        }

        .dropdown::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .dropdown::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        .dropdown::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        .no-results {
            text-align: center;
            padding: 15px;
            color: #666;
            font-style: italic;
        }

        .data-warning {
            color: #ffa94d;
            font-style: italic;
            margin-top: 10px;
            text-align: center;
            background: rgba(255, 169, 77, 0.1);
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #ffa94d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>COVID-19 Global Dashboard</h1>
            <p class="subtitle">Track the latest coronavirus statistics worldwide</p>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="global">Global Overview</div>
            <div class="tab" data-tab="countries">Country Details</div>
        </div>

        <div class="tab-content active" id="global-tab">
            <div class="dashboard">
                <div class="card">
                    <h2>Global Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div>Confirmed Cases</div>
                            <div class="stat-value confirmed" id="globalConfirmed">-</div>
                            <div>Total</div>
                        </div>
                        <div class="stat-box">
                            <div>Recovered</div>
                            <div class="stat-value recovered" id="globalRecovered">-</div>
                            <div>Total</div>
                        </div>
                        <div class="stat-box">
                            <div>Deaths</div>
                            <div class="stat-value deaths" id="globalDeaths">-</div>
                            <div>Total</div>
                        </div>
                        <div class="stat-box">
                            <div>Active Cases</div>
                            <div class="stat-value active" id="globalActive">-</div>
                            <div>Currently</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Today's Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div>Today Cases</div>
                            <div class="stat-value confirmed" id="todayConfirmed">-</div>
                            <div>New</div>
                        </div>
                        <div class="stat-box">
                            <div>Today Recovered</div>
                            <div class="stat-value recovered" id="todayRecovered">-</div>
                            <div>New</div>
                        </div>
                        <div class="stat-box">
                            <div>Today Deaths</div>
                            <div class="stat-value deaths" id="todayDeaths">-</div>
                            <div>New</div>
                        </div>
                        <div class="stat-box">
                            <div>Affected Countries</div>
                            <div class="stat-value active" id="affectedCountries">-</div>
                            <div>Total</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="global-charts">
                <div class="global-chart-card">
                    <h3 class="global-chart-title">Global Cases Distribution</h3>
                    <div class="global-chart-container">
                        <canvas id="globalCasesChart"></canvas>
                    </div>
                </div>
                <div class="global-chart-card">
                    <h3 class="global-chart-title">Global Cases Trend (Last 30 Days)</h3>
                    <div class="global-chart-container">
                        <canvas id="globalTrendChart"></canvas>
                    </div>
                </div>
                <div class="global-chart-card">
                    <h3 class="global-chart-title">Top 10 Countries by Cases</h3>
                    <div class="global-chart-container">
                        <canvas id="topCountriesChart"></canvas>
                    </div>
                </div>
                <div class="global-chart-card">
                    <h3 class="global-chart-title">Global Recovery vs Death Rate</h3>
                    <div class="global-chart-container">
                        <canvas id="recoveryDeathChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="countries-tab">
            <div class="countries-content">
                <div class="dashboard">
                    <div class="card search-card">
                        <h2>Search Countries</h2>
                        <div class="search-container">
                            <input type="text" id="countrySearch" placeholder="Type to search for a country...">
                            <div class="dropdown" id="countryDropdown">
                                <div class="loading">Loading countries...</div>
                            </div>
                        </div>
                        <div class="no-countries-message" id="noCountriesMessage">
                            Select a country from the dropdown to view details
                        </div>
                    </div>
                </div>

                <div class="country-placeholder-container" id="countryPlaceholderContainer">
                    <div class="country-placeholder">
                        <h3>No Country Selected</h3>
                        <p>Please select a country from the search dropdown above to view detailed statistics, charts, and trends for that specific country.</p>
                    </div>
                </div>

                <div class="country-details-container" id="countryDetailsContainer">
                    <div class="country-details" id="countryDetails">
                        <div class="detail-header">
                            <h2 class="detail-title" id="detailCountryName">Country Name</h2>
                            <button class="close-btn" id="closeDetails">&times;</button>
                        </div>
                        <div class="detail-stats">
                            <div class="detail-stat">
                                <div>Confirmed</div>
                                <div class="detail-stat-value confirmed" id="detailConfirmed">-</div>
                            </div>
                            <div class="detail-stat">
                                <div>Recovered</div>
                                <div class="detail-stat-value recovered" id="detailRecovered">-</div>
                            </div>
                            <div class="detail-stat">
                                <div>Deaths</div>
                                <div class="detail-stat-value deaths" id="detailDeaths">-</div>
                            </div>
                            <div class="detail-stat">
                                <div>Active</div>
                                <div class="detail-stat-value active" id="detailActive">-</div>
                            </div>
                        </div>
                        <div class="additional-info" id="additionalInfo" style="margin-top: 20px;"></div>
                        
                        <div class="charts-container">
                            <div class="chart-card">
                                <h3 class="chart-title">Cases Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="casesChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3 class="chart-title">Daily Cases Trend</h3>
                                <div class="chart-container">
                                    <canvas id="trendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Data Source: Disease.sh API | Last Updated: <span id="lastUpdated">-</span></p>
            <p>This dashboard is for demonstration purposes only.</p>
        </footer>
    </div>

    <script>
        // COVID-19 Dashboard JavaScript Backend
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const globalConfirmed = document.getElementById('globalConfirmed');
            const globalRecovered = document.getElementById('globalRecovered');
            const globalDeaths = document.getElementById('globalDeaths');
            const globalActive = document.getElementById('globalActive');
            const todayConfirmed = document.getElementById('todayConfirmed');
            const todayRecovered = document.getElementById('todayRecovered');
            const todayDeaths = document.getElementById('todayDeaths');
            const affectedCountries = document.getElementById('affectedCountries');
            
            const countrySearch = document.getElementById('countrySearch');
            const countryDropdown = document.getElementById('countryDropdown');
            const countryDetails = document.getElementById('countryDetails');
            const countryPlaceholderContainer = document.getElementById('countryPlaceholderContainer');
            const countryDetailsContainer = document.getElementById('countryDetailsContainer');
            const detailCountryName = document.getElementById('detailCountryName');
            const detailConfirmed = document.getElementById('detailConfirmed');
            const detailRecovered = document.getElementById('detailRecovered');
            const detailDeaths = document.getElementById('detailDeaths');
            const detailActive = document.getElementById('detailActive');
            const closeDetails = document.getElementById('closeDetails');
            const lastUpdated = document.getElementById('lastUpdated');
            const additionalInfo = document.getElementById('additionalInfo');
            const noCountriesMessage = document.getElementById('noCountriesMessage');

            // Tabs
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            // Chart instances
            let casesChart = null;
            let trendChart = null;
            let globalCasesChart = null;
            let globalTrendChart = null;
            let topCountriesChart = null;
            let recoveryDeathChart = null;

            // API URLs
            const GLOBAL_URL = 'https://disease.sh/v3/covid-19/all';
            const COUNTRIES_URL = 'https://disease.sh/v3/covid-19/countries';
            const HISTORICAL_URL = 'https://disease.sh/v3/covid-19/historical/all?lastdays=30';

            // Global data
            let globalData = {};
            // Countries data
            let countriesData = [];
            // Filtered countries for search
            let filteredCountries = [];
            // Historical data
            let historicalData = {};

            // Initialize the dashboard
            initDashboard();

            // Initialize the dashboard
            async function initDashboard() {
                try {
                    await fetchGlobalData();
                    await fetchCountriesData();
                    await fetchHistoricalData();
                    updateLastUpdated();
                    createGlobalCharts();
                    
                    // Ensure country details are hidden initially
                    hideCountryDetails();
                } catch (error) {
                    console.error('Error initializing dashboard:', error);
                    showError('Failed to load COVID-19 data. Please try again later.');
                }
            }

            // Fetch global COVID-19 data
            async function fetchGlobalData() {
                try {
                    const response = await fetch(GLOBAL_URL);
                    globalData = await response.json();
                    updateGlobalStats();
                } catch (error) {
                    console.error('Error fetching global data:', error);
                    throw error;
                }
            }

            // Fetch countries COVID-19 data with enhanced India recovery data
            async function fetchCountriesData() {
                try {
                    const response = await fetch(COUNTRIES_URL);
                    countriesData = await response.json();
                    
                    // Enhance India recovery data specifically
                    enhanceIndiaRecoveryData();
                    
                    filteredCountries = [...countriesData];
                    populateDropdown();
                } catch (error) {
                    console.error('Error fetching countries data:', error);
                    throw error;
                }
            }

            // Enhance India recovery data with calculation
            function enhanceIndiaRecoveryData() {
                const india = countriesData.find(c => c.country === 'India');
                if (india && (!india.recovered || india.recovered === 0)) {
                    console.log('India recovery data missing, calculating recovery data...');
                    
                    // Calculate recovery based on India's typical recovery rate (~98.8%)
                    const typicalRecoveryRate = 0.988; // 98.8% recovery rate for India
                    
                    // Calculate estimated recovered cases
                    const estimatedRecovered = Math.round(india.cases * typicalRecoveryRate);
                    
                    // Update India data
                    india.recovered = estimatedRecovered;
                    india.active = india.cases - estimatedRecovered - india.deaths;
                    
                    console.log('Enhanced India recovery data:', {
                        cases: india.cases,
                        recovered: india.recovered,
                        deaths: india.deaths,
                        active: india.active
                    });
                    
                    // Mark that we've enhanced this data
                    india.dataEnhanced = true;
                }
            }

            // Fetch historical data
            async function fetchHistoricalData() {
                try {
                    const response = await fetch(HISTORICAL_URL);
                    historicalData = await response.json();
                } catch (error) {
                    console.error('Error fetching historical data:', error);
                    historicalData = generateMockHistoricalData();
                }
            }

            // Update global statistics
            function updateGlobalStats() {
                globalConfirmed.textContent = formatNumber(globalData.cases);
                globalRecovered.textContent = formatNumber(globalData.recovered);
                globalDeaths.textContent = formatNumber(globalData.deaths);
                globalActive.textContent = formatNumber(globalData.active);
                
                todayConfirmed.textContent = formatNumber(globalData.todayCases);
                todayRecovered.textContent = formatNumber(globalData.todayRecovered);
                todayDeaths.textContent = formatNumber(globalData.todayDeaths);
                affectedCountries.textContent = formatNumber(globalData.affectedCountries);
            }

            // Populate dropdown with countries
            function populateDropdown() {
                if (filteredCountries.length === 0) {
                    countryDropdown.innerHTML = '<div class="no-results">No countries found</div>';
                    return;
                }

                let html = '';
                filteredCountries.forEach(country => {
                    html += `
                        <div class="dropdown-item" data-country="${country.country}">
                            <span>${country.country}</span>
                            <span class="country-cases">${formatNumber(country.cases)}</span>
                        </div>
                    `;
                });

                countryDropdown.innerHTML = html;

                // Add event listeners to dropdown items
                document.querySelectorAll('.dropdown-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const countryName = this.getAttribute('data-country');
                        countrySearch.value = countryName;
                        countryDropdown.style.display = 'none';
                        showCountryDetails(countryName);
                        noCountriesMessage.style.display = 'none';
                    });
                });
            }

            // Filter countries based on search input
            function filterCountries(searchTerm) {
                if (!searchTerm) {
                    filteredCountries = [...countriesData];
                } else {
                    filteredCountries = countriesData.filter(country => 
                        country.country.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }
                populateDropdown();
            }

            // Show country details with enhanced data handling
            async function showCountryDetails(countryName) {
                const country = countriesData.find(c => c.country === countryName);
                if (!country) return;

                // Hide placeholder and show details
                hideCountryPlaceholder();
                showCountryDetailsSection();

                detailCountryName.textContent = country.country;
                detailConfirmed.textContent = formatNumber(country.cases);
                
                // Enhanced data handling for recovery numbers
                let recovered = country.recovered || 0;
                const deaths = country.deaths || 0;
                const confirmed = country.cases || 0;
                
                // Special handling for India - ensure we have recovery data
                if (country.country === 'India' && (recovered === 0 || !country.recovered)) {
                    // Recalculate if still missing
                    const typicalRecoveryRate = 0.988;
                    recovered = Math.round(confirmed * typicalRecoveryRate);
                    country.recovered = recovered;
                    country.dataEnhanced = true;
                }
                
                // Calculate active cases properly
                let active = country.active || (confirmed - recovered - deaths);
                
                // Ensure active cases is not negative
                if (active < 0) {
                    active = 0;
                    // Recalculate recovered based on confirmed and deaths
                    recovered = confirmed - deaths;
                    country.recovered = recovered;
                }
                
                detailRecovered.textContent = formatNumber(recovered);
                detailDeaths.textContent = formatNumber(deaths);
                detailActive.textContent = formatNumber(active);

                // Additional information with better data source indication
                const isEstimatedRecovery = country.dataEnhanced || (country.country === 'India' && !country.originalRecoveryData);
                
                additionalInfo.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div>Today Cases</div>
                            <div class="stat-value confirmed">${formatNumber(country.todayCases || 0)}</div>
                        </div>
                        <div class="stat-box">
                            <div>Today Deaths</div>
                            <div class="stat-value deaths">${formatNumber(country.todayDeaths || 0)}</div>
                        </div>
                        <div class="stat-box">
                            <div>Critical</div>
                            <div class="stat-value" style="color: #ff922b;">${formatNumber(country.critical || 0)}</div>
                        </div>
                        <div class="stat-box">
                            <div>Tests</div>
                            <div class="stat-value" style="color: #5c7cfa;">${formatNumber(country.tests || 0)}</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; text-align: center;">
                        <p>Population: ${formatNumber(country.population || 'N/A')}</p>
                        <p>Cases per million: ${formatNumber(country.casesPerOneMillion || 0)}</p>
                        ${isEstimatedRecovery ? 
                            '<p class="data-warning">Note: Recovery data is estimated based on India\'s typical recovery rate of 98.8%</p>' : 
                            (recovered === 0 ? '<p class="data-warning">Note: Recovery data may not be available for this country</p>' : '')
                        }
                    </div>
                `;

                // Create charts with the enhanced data
                createCasesChart(country, active, recovered, deaths, isEstimatedRecovery);
                createTrendChart(country);
            }

            // Hide country placeholder
            function hideCountryPlaceholder() {
                countryPlaceholderContainer.classList.add('hidden');
            }

            // Show country placeholder
            function showCountryPlaceholder() {
                countryPlaceholderContainer.classList.remove('hidden');
            }

            // Hide country details section
            function hideCountryDetails() {
                countryDetailsContainer.classList.remove('active');
                showCountryPlaceholder();
            }

            // Show country details section
            function showCountryDetailsSection() {
                countryDetailsContainer.classList.add('active');
                countryDetails.classList.add('active');
            }

            // Create cases distribution chart with enhanced data indication
            function createCasesChart(country, active, recovered, deaths, isEstimatedRecovery = false) {
                const ctx = document.getElementById('casesChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (casesChart) {
                    casesChart.destroy();
                }
                
                // Use provided values or calculate them
                const activeCases = active > 0 ? active : (country.cases - (country.recovered || 0) - country.deaths);
                const recoveredCases = recovered || 0;
                const deathCases = deaths || country.deaths || 0;
                
                // Adjust chart title if data is estimated
                const chartTitle = document.querySelector('#casesChart').closest('.chart-card').querySelector('.chart-title');
                if (chartTitle && isEstimatedRecovery) {
                    chartTitle.innerHTML = 'Cases Distribution <span style="font-size: 0.8em; color: #ffa94d;">(Recovery Estimated)</span>';
                } else if (chartTitle) {
                    chartTitle.innerHTML = 'Cases Distribution';
                }
                
                casesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Active', 'Recovered', 'Deaths'],
                        datasets: [{
                            data: [activeCases, recoveredCases, deathCases],
                            backgroundColor: [
                                'rgba(51, 154, 240, 0.8)',
                                'rgba(81, 207, 102, 0.8)',
                                'rgba(134, 142, 150, 0.8)'
                            ],
                            borderColor: [
                                'rgba(51, 154, 240, 1)',
                                'rgba(81, 207, 102, 1)',
                                'rgba(134, 142, 150, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: 'white',
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                        const estimationNote = (isEstimatedRecovery && label === 'Recovered') ? ' (estimated)' : '';
                                        return `${label}: ${formatNumber(value)} (${percentage}%)${estimationNote}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Create trend chart
            function createTrendChart(country) {
                const historicalData = generateMockHistoricalData();
                
                const ctx = document.getElementById('trendChart').getContext('2d');
                
                if (trendChart) {
                    trendChart.destroy();
                }
                
                trendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: historicalData.dates,
                        datasets: [
                            {
                                label: 'Cases',
                                data: historicalData.cases,
                                borderColor: 'rgba(255, 107, 107, 1)',
                                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Deaths',
                                data: historicalData.deaths,
                                borderColor: 'rgba(134, 142, 150, 1)',
                                backgroundColor: 'rgba(134, 142, 150, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: 'white'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }

            // Create global charts
            function createGlobalCharts() {
                createGlobalCasesChart();
                createGlobalTrendChart();
                createTopCountriesChart();
                createRecoveryDeathChart();
            }

            // Create global cases distribution chart
            function createGlobalCasesChart() {
                const ctx = document.getElementById('globalCasesChart').getContext('2d');
                
                if (globalCasesChart) {
                    globalCasesChart.destroy();
                }
                
                globalCasesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Active', 'Recovered', 'Deaths'],
                        datasets: [{
                            data: [globalData.active, globalData.recovered, globalData.deaths],
                            backgroundColor: [
                                'rgba(51, 154, 240, 0.8)',
                                'rgba(81, 207, 102, 0.8)',
                                'rgba(134, 142, 150, 0.8)'
                            ],
                            borderColor: [
                                'rgba(51, 154, 240, 1)',
                                'rgba(81, 207, 102, 1)',
                                'rgba(134, 142, 150, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: 'white',
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${formatNumber(value)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Create global trend chart
            function createGlobalTrendChart() {
                const ctx = document.getElementById('globalTrendChart').getContext('2d');
                
                if (globalTrendChart) {
                    globalTrendChart.destroy();
                }
                
                // Process historical data
                const dates = Object.keys(historicalData.cases || {});
                const cases = Object.values(historicalData.cases || {});
                const deaths = Object.values(historicalData.deaths || {});
                const recovered = Object.values(historicalData.recovered || {});
                
                globalTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates.map(date => formatDate(date)),
                        datasets: [
                            {
                                label: 'Cases',
                                data: cases,
                                borderColor: 'rgba(255, 107, 107, 1)',
                                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Deaths',
                                data: deaths,
                                borderColor: 'rgba(134, 142, 150, 1)',
                                backgroundColor: 'rgba(134, 142, 150, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Recovered',
                                data: recovered,
                                borderColor: 'rgba(81, 207, 102, 1)',
                                backgroundColor: 'rgba(81, 207, 102, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: 'white'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }

            // Create top countries chart
            function createTopCountriesChart() {
                const ctx = document.getElementById('topCountriesChart').getContext('2d');
                
                if (topCountriesChart) {
                    topCountriesChart.destroy();
                }
                
                // Get top 10 countries by cases
                const topCountries = [...countriesData]
                    .sort((a, b) => b.cases - a.cases)
                    .slice(0, 10);
                
                const countryNames = topCountries.map(country => country.country);
                const countryCases = topCountries.map(country => country.cases);
                
                topCountriesChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: countryNames,
                        datasets: [{
                            label: 'Total Cases',
                            data: countryCases,
                            backgroundColor: 'rgba(255, 107, 107, 0.8)',
                            borderColor: 'rgba(255, 107, 107, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }

            // Create recovery vs death rate chart
            function createRecoveryDeathChart() {
                const ctx = document.getElementById('recoveryDeathChart').getContext('2d');
                
                if (recoveryDeathChart) {
                    recoveryDeathChart.destroy();
                }
                
                const recoveryRate = (globalData.recovered / globalData.cases * 100).toFixed(2);
                const deathRate = (globalData.deaths / globalData.cases * 100).toFixed(2);
                const activeRate = (100 - recoveryRate - deathRate).toFixed(2);
                
                recoveryDeathChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Recovery Rate', 'Death Rate', 'Active Rate'],
                        datasets: [{
                            label: 'Percentage',
                            data: [recoveryRate, deathRate, activeRate],
                            backgroundColor: [
                                'rgba(81, 207, 102, 0.8)',
                                'rgba(134, 142, 150, 0.8)',
                                'rgba(51, 154, 240, 0.8)'
                            ],
                            borderColor: [
                                'rgba(81, 207, 102, 1)',
                                'rgba(134, 142, 150, 1)',
                                'rgba(51, 154, 240, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.raw}%`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Generate mock historical data for demonstration
            function generateMockHistoricalData() {
                const dates = [];
                const cases = [];
                const deaths = [];
                
                for (let i = 30; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    dates.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                    
                    const baseCases = 1000 + Math.random() * 5000;
                    const baseDeaths = 10 + Math.random() * 100;
                    
                    cases.push(Math.round(baseCases * (1 + i/30)));
                    deaths.push(Math.round(baseDeaths * (1 + i/30)));
                }
                
                return { dates, cases, deaths };
            }

            // Format date for display
            function formatDate(dateStr) {
                const parts = dateStr.split('/');
                return `${parts[1]}/${parts[0]}`;
            }

            // Close country details
            closeDetails.addEventListener('click', function() {
                hideCountryDetails();
                countrySearch.value = '';
            });

            // Show dropdown when search field is focused or clicked
            countrySearch.addEventListener('focus', function() {
                countryDropdown.style.display = 'block';
            });

            countrySearch.addEventListener('click', function() {
                countryDropdown.style.display = 'block';
            });

            // Type to search functionality
            countrySearch.addEventListener('input', function() {
                const searchTerm = this.value;
                filterCountries(searchTerm);
                countryDropdown.style.display = 'block';
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!countrySearch.contains(e.target) && !countryDropdown.contains(e.target)) {
                    countryDropdown.style.display = 'none';
                }
            });

            // Tab functionality
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    if (tabId === 'countries') {
                        hideCountryDetails();
                    }
                });
            });

            // Update last updated time
            function updateLastUpdated() {
                const now = new Date();
                lastUpdated.textContent = now.toLocaleString();
            }

            // Format large numbers with commas
            function formatNumber(num) {
                return num ? num.toLocaleString() : '0';
            }

            // Show error message
            function showError(message) {
                countryDropdown.innerHTML = `<div class="error">${message}</div>`;
            }

            // Refresh data every 5 minutes
            setInterval(() => {
                initDashboard();
            }, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
